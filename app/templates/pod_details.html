{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Pod Details</h2>
    <div>
        <a href="{{ url_for('main.show_logs_page', namespace=details.namespace, name=details.name) }}"
            class="btn btn-success me-2">View Logs</a>
        <a href="{{ url_for('main.pods_list', namespace=source_namespace) }}" class="btn btn-secondary">Back to Pods</a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">{{ details.name }}</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <dl class="row">
                    <dt class="col-sm-3">Namespace</dt>
                    <dd class="col-sm-9">{{ details.namespace }}</dd>
                    <dt class="col-sm-3">Node</dt>
                    <dd class="col-sm-9">{{ details.node }}</dd>
                    <dt class="col-sm-3">Start Time</dt>
                    <dd class="col-sm-9">{{ details.start_time }}</dd>
                </dl>
            </div>
            <div class="col-md-6">
                <dl class="row">
                    <dt class="col-sm-3">Status</dt>
                    <dd class="col-sm-9">
                        {% if details.status == 'Running' %}
                        <span class="badge bg-success">{{ details.status }}</span>
                        {% elif details.status == 'Succeeded' %}
                        <span class="badge bg-primary">{{ details.status }}</span>
                        {% elif details.status == 'Pending' %}
                        <span class="badge bg-warning">{{ details.status }}</span>
                        {% else %}
                        <span class="badge bg-danger">{{ details.status }}</span>
                        {% endif %}
                    </dd>
                    <dt class="col-sm-3">Pod IP</dt>
                    <dd class="col-sm-9">{{ details.pod_ip }}</dd>
                    <dt class="col-sm-3">Service Account</dt>
                    <dd class="col-sm-9">{{ details.service_account }}</dd>
                </dl>
            </div>
        </div>
        <h6>Labels</h6>
        <p>
            {% for key, value in details.labels.items() %}
            <span class="badge bg-info">{{ key }}={{ value }}</span>
            {% endfor %}
        </p>
    </div>
</div>

<h4 class="mt-4">Conditions</h4>
<table class="table table-bordered table-sm">
    <thead class="table-light">
        <tr>
            <th>Type</th>
            <th>Status</th>
            <th>Last Transition Time</th>
        </tr>
    </thead>
    <tbody>
        {% for cond in details.conditions %}
        <tr>
            <td>{{ cond.type }}</td>
            <td>{{ cond.status }}</td>
            <td>{{ cond.last_transition_time }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h4 class="mt-4">Containers</h4>
{% for container in details.containers %}
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0">Container: {{ container.name }}</h5>
            <a href="{{ url_for('main.terminal_page', namespace=details.namespace, name=details.name, container=container.name) }}"
                class="btn btn-sm btn-dark">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-terminal-fill me-1" viewBox="0 0 16 16">
                    <path
                        d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm9.5 5.5h-3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zm-6.354-.354a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L6.5 10.293 3.146 8.146z" />
                </svg>
                Terminal
            </a>
        </div>
        <p><strong>Image:</strong> {{ container.image }}</p>
        <p><strong>State:</strong> {{ container.state }} | <strong>Ready:</strong> {{ container.ready }} |
            <strong>Restarts:</strong> {{ container.restarts }}
        </p>

        <h6>Environment Variables</h6>
        <table class="table table-sm table-borderless">
            {% for env in container.env %}
            <tr>
                <td style="width: 30%;">{{ env.name }}</td>
                <td>{{ env.value }}</td>
            </tr>
            {% else %}
            <tr>
                <td>None</td>
            </tr>
            {% endfor %}
        </table>

        <h6>Mounts</h6>
        <table class="table table-sm table-borderless">
            {% for mount in container.mounts %}
            <tr>
                <td style="width: 30%;">{{ mount.name }}</td>
                <td>{{ mount.mount_path }} ({{ 'ro' if mount.read_only else 'rw' }})</td>
            </tr>
            {% else %}
            <tr>
                <td>None</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endfor %}

<h4 class="mt-4">Events</h4>
<table class="table table-striped table-sm">
    <thead class="table-light">
        <tr>
            <th>Last Seen</th>
            <th>Type</th>
            <th>Reason</th>
            <th>Message</th>
        </tr>
    </thead>
    <tbody>
        {% for event in details.events %}
        <tr>
            <td>{{ event.last_seen }}</td>
            <td>
                {% if event.type == 'Warning' %}
                <span class="badge bg-warning text-dark">{{ event.type }}</span>
                {% else %}
                <span class="badge bg-secondary">{{ event.type }}</span>
                {% endif %}
            </td>
            <td>{{ event.reason }}</td>
            <td>{{ event.message }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" class="text-center">No events found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}