{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Job Details</h2>
    <a href="{{ url_for('main.jobs_list', namespace=details.namespace) }}" class="btn btn-secondary">Back to Jobs</a>
</div>

<div class="card mb-4">
    <div class="card-header"><h5 class="card-title mb-0">{{ details.name }}</h5></div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Namespace</dt><dd class="col-sm-9">{{ details.namespace }}</dd>
            <dt class="col-sm-3">Created</dt><dd class="col-sm-9">{{ details.creation_timestamp }}</dd>
            <dt class="col-sm-3">Controlled By</dt>
            <dd class="col-sm-9">
                {% for owner in details.owner_references %}
                    {# In the future, you could add a link for CronJob here #}
                    {{ owner.kind }}/{{ owner.name }}
                {% else %}
                    &lt;none&gt;
                {% endfor %}
            </dd>
        </dl>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header"><h5 class="card-title mb-0">Status</h5></div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Completions</dt><dd class="col-sm-9">{{ details.spec.completions }}</dd>
            <dt class="col-sm-3">Parallelism</dt><dd class="col-sm-9">{{ details.spec.parallelism }}</dd>
            <dt class="col-sm-3">Succeeded</dt><dd class="col-sm-9">{{ details.status.succeeded }}</dd>
            <dt class="col-sm-3">Failed</dt><dd class="col-sm-9">{{ details.status.failed }}</dd>
            <dt class="col-sm-3">Active</dt><dd class="col-sm-9">{{ details.status.active }}</dd>
        </dl>
    </div>
</div>

<h4 class="mt-4">Pods</h4>
<table class="table table-striped table-sm">
    <thead class="table-light"><tr><th>Name</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody>
    {% for pod in details.pods %}
        <tr>
            <td>{{ pod.name }}</td>
            <td>{{ pod.status }}</td>
            <td>
                <a href="{{ url_for('main.describe_pod', namespace=details.namespace, name=pod.name) }}" class="btn btn-info btn-sm">Describe</a>
                <a href="{{ url_for('main.show_logs_page', namespace=details.namespace, name=pod.name) }}" class="btn btn-success btn-sm">Logs</a>
            </td>
        </tr>
    {% else %}
        <tr><td colspan="3" class="text-center">No pods found for this job.</td></tr>
    {% endfor %}
    </tbody>
</table>


<h4 class="mt-4">Events</h4>
<table class="table table-striped table-sm">
    <thead class="table-light"><tr><th>Last Seen</th><th>Type</th><th>Reason</th><th>Message</th></tr></thead>
    <tbody>
    {% for event in details.events %}
        <tr>
            <td>{{ event.last_seen }}</td>
            <td><span class="badge bg-{{ 'warning text-dark' if event.type == 'Warning' else 'secondary' }}">{{ event.type }}</span></td>
            <td>{{ event.reason }}</td><td>{{ event.message }}</td>
        </tr>
    {% else %}
        <tr><td colspan="4" class="text-center">No events found.</td></tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}