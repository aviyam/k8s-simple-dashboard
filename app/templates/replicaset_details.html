{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">ReplicaSet Details</h2>
    <a href="{{ url_for('main.replica_sets_list', namespace=details.namespace) }}" class="btn btn-secondary">Back to ReplicaSets</a>
</div>

<div class="card mb-4">
    <div class="card-header"><h5 class="card-title mb-0">{{ details.name }}</h5></div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Namespace</dt><dd class="col-sm-9">{{ details.namespace }}</dd>
            <dt class="col-sm-3">Created</dt><dd class="col-sm-9">{{ details.creation_timestamp }}</dd>
            <dt class="col-sm-3">Controlled By</dt>
            <dd class="col-sm-9">
                {# NEW: This section now creates a link if the owner is a Deployment #}
                {% for owner in details.owner_references %}
                    {% if owner.kind == 'Deployment' %}
                        <a href="{{ url_for('main.describe_deployment', namespace=details.namespace, name=owner.name) }}">{{ owner.kind }}/{{ owner.name }}</a>
                    {% else %}
                        {{ owner.kind }}/{{ owner.name }}
                    {% endif %}
                {% else %}
                    &lt;none&gt;
                {% endfor %}
            </dd>
            <dt class="col-sm-3">Labels</dt>
            <dd class="col-sm-9">
                {% for key, value in details.labels.items() %}
                <span class="badge bg-info text-dark">{{ key }}={{ value }}</span>
                {% endfor %}
            </dd>
        </dl>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header"><h5 class="card-title mb-0">Status</h5></div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Desired Replicas</dt><dd class="col-sm-9">{{ details.replicas_status.desired }}</dd>
            <dt class="col-sm-3">Current Replicas</dt><dd class="col-sm-9">{{ details.replicas_status.current }}</dd>
            <dt class="col-sm-3">Ready Replicas</dt><dd class="col-sm-9">{{ details.replicas_status.ready }}</dd>
        </dl>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header"><h5 class="card-title mb-0">Pod Template</h5></div>
    <div class="card-body">
        <h6>Labels</h6>
        <p>{% for key, value in details.pod_template.labels.items() %}<span class="badge bg-secondary">{{ key }}={{ value }}</span> {% endfor %}</p>
        <hr/>
        <h6>Containers</h6>
        {% for c in details.pod_template.containers %}
            <p><strong>{{ c.name }}</strong>: {{ c.image }}</p>
        {% endfor %}
    </div>
</div>

<h4 class="mt-4">Events</h4>
<table class="table table-striped table-sm">
    <thead class="table-light"><tr><th>Last Seen</th><th>Type</th><th>Reason</th><th>Message</th></tr></thead>
    <tbody>
    {% for event in details.events %}
        <tr>
            <td>{{ event.last_seen }}</td>
            <td><span class="badge bg-{{ 'warning text-dark' if event.type == 'Warning' else 'secondary' }}">{{ event.type }}</span></td>
            <td>{{ event.reason }}</td><td>{{ event.message }}</td>
        </tr>
    {% else %}
        <tr><td colspan="4" class="text-center">No events found.</td></tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}